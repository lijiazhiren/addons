# -----------------------------------------------------------
# 使用标准 Alpine 镜像作为基础镜像 (解决 403 错误)
# -----------------------------------------------------------
FROM alpine:3.18

# 设置作者
LABEL io.hass.name="Workday Alarm Clock" io.hass.version="1.0.0"

# -----------------------------------------------------------
# 安装依赖
# -----------------------------------------------------------
RUN apk update && \
    apk add --no-cache \
        bash \
        sox \
        curl \
        alsa-utils \
        alsa-lib \
        alsa-lib-dev && \
    rm -rf /var/cache/apk/*

# -----------------------------------------------------------
# 复制程序文件和启动脚本
# -----------------------------------------------------------
# 将 rootfs 目录下的所有文件复制到容器的根目录
COPY rootfs/ /

# -----------------------------------------------------------
# 赋予可执行权限 (路径已修正，现在 run.sh 应该在根目录下)
# -----------------------------------------------------------
RUN chmod +x /usr/bin/workdayAlarmClock /usr/bin/meMp3Player /run.sh

# -----------------------------------------------------------
# 容器运行时配置
# -----------------------------------------------------------
EXPOSE 8080/tcp

# 启动命令：直接运行 /run.sh 脚本 (已修正)
CMD [ "/bin/bash", "/run.sh" ]
