# -----------------------------------------------------------
# 使用标准的 Debian 基础镜像 (与 Ubuntu/glibc 兼容)
# -----------------------------------------------------------
FROM debian:bookworm-slim

# 设置作者
LABEL io.hass.name="Workday Alarm Clock" io.hass.version="1.0.0"

# -----------------------------------------------------------
# 安装依赖
# -----------------------------------------------------------
# Debian 环境下，依赖包名略有不同
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        bash \
        sox \
        curl \
        # ALSA 音频依赖
        alsa-utils \
        libasound2 \
        libsox-fmt-all && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# -----------------------------------------------------------
# 复制程序文件和启动脚本
# -----------------------------------------------------------
COPY rootfs/ /

# -----------------------------------------------------------
# 赋予可执行权限 (路径保持不变)
# -----------------------------------------------------------
RUN chmod +x /usr/bin/workdayAlarmClock /usr/bin/meMp3Player /run.sh

# -----------------------------------------------------------
# 容器运行时配置
# -----------------------------------------------------------
EXPOSE 8080/tcp

# 启动命令：直接运行 /run.sh 脚本
CMD [ "/bin/bash", "/run.sh" ]
